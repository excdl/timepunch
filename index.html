<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å¥‡å¯æ™ºèƒ½æ‰“å¡</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { font-family: Arial; text-align:center; padding:20px; }
    button { padding:10px 20px; font-size:18px; }
  </style>
</head>
<body>
  <h2>å¥‡å¯æ™ºèƒ½æ‰“å¡ç³»çµ±</h2>
  <button id="clockInBtn">æ‰“å¡</button>

  <script>
    const API_ENDPOINT = "https://script.google.com/macros/s/AKfycbzpZcuqiDC-YXwprzzGkzACgIgQoe_iHIs4juYgnWNfk7tdOFcVy4tKrec50_68wqDG/exec";

    async function getUserIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip;
      } catch {
        return "æœªçŸ¥";
      }
    }

    async function clockIn() {
      const btn = document.getElementById("clockInBtn");
      btn.disabled = true;

      try {
        await liff.init({ liffId: "2008499706-eBayB9Yd" });
        if (!liff.isLoggedIn()) liff.login();

        const profile = await liff.getProfile();
        const lineId = profile.userId;
        const name = profile.displayName;

        const ip = await getUserIP();
        const now = new Date();
        const date = now.toLocaleDateString("zh-TW");
        const time = now.toLocaleTimeString("zh-TW");

        const res = await fetch(API_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ date, time, lineId, name, ip })
        });

        const data = await res.json();

        Swal.fire({
          icon: data.success ? "success" : "error",
          title: data.success ? "ğŸ‰ æ‰“å¡æˆåŠŸ" : "âš  æ‰“å¡å¤±æ•—",
          text: data.message,
          timer: 3000,
          showConfirmButton: false
        });

      } catch (err) {
        Swal.fire("âš  ç™¼ç”ŸéŒ¯èª¤", err.message || err, "error");
      } finally {
        btn.disabled = false;
      }
    }

    document.getElementById("clockInBtn").addEventListener("click", clockIn);
  </script>
</body>
</html>



